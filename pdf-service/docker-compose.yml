# Local testing for PDF service (no ECS).
# Set env in .env or pass: SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, NEXT_PUBLIC_APP_URL
# NEXT_PUBLIC_APP_URL should be reachable from container (e.g. http://host.docker.internal:3000 when Next.js runs on host)
# Optional: DOCKER_PLATFORM=linux/amd64 to build for ECS/Fargate; leave unset for host-native (e.g. Apple Silicon).
services:
  pdf-service:
    build:
      context: .
    platform: ${DOCKER_PLATFORM:-}
    ports:
      - "3001:3001"
    environment:
      - PORT=3001
      - NEXT_PUBLIC_APP_URL=${NEXT_PUBLIC_APP_URL:-http://host.docker.internal:3000}
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - SUPABASE_STORAGE_BUCKET=${SUPABASE_STORAGE_BUCKET:-reports-pdf}
      - POLL_INTERVAL_MS=${POLL_INTERVAL_MS:-5000}
    extra_hosts:
      - "host.docker.internal:host-gateway"
